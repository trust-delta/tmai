# AskUserQuestion対応

Claude CodeのAskUserQuestionツールで提示される選択肢を直接選択。

## 概要

Claude Codeが`AskUserQuestion`ツールで選択肢を提示した場合、tmaiでは番号キーで直接選択できます。手動で回答を入力する必要はありません。

## 動作の流れ

### Claude Codeが質問を表示：

```
┌─────────────────────────────────────────────────────────────┐
│ どのアプローチを好みますか？                                 │
│                                                             │
│ ❯ 1. async/awaitを使う                                      │
│   2. callbacksを使う                                        │
│   3. promisesを使う                                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### tmaiでの操作：

`1`、`2`、または`3`を押すだけ。

## キーバインド

| キー | 動作 |
|------|------|
| `1-9` | 番号で選択 |
| `１-９` | 全角数字も対応 |
| `Space` | 選択をトグル（複数選択モード） |
| `Enter` | 複数選択を確定 |

## 単一選択 vs 複数選択

### 単一選択

番号キーを押すと即座に選択・確定されます。

```
どのフレームワークを使いますか？

❯ 1. React
  2. Vue
  3. Svelte
```

`2`を押す → Vueが選択・送信される。

### 複数選択

`multi_select: true`の場合、Spaceで選択をトグルし、Enterで確定します。

```
どの機能が必要ですか？（複数選択可）

❯ 1. [ ] 認証
  2. [ ] ダークモード
  3. [ ] API連携
  4. [ ] テスト
```

1. `1`またはSpaceを押す → 認証をトグル
2. `3`を押す → API連携をトグル
3. Enterを押す → 選択を確定

## 検出

tmaiは以下のAskUserQuestionパターンを検出します：

- 番号付き選択肢（`1.`、`2.`など）
- 選択カーソル（`❯`または`>`）
- 複数選択チェックボックス（`[ ]`、`[x]`）

### 検出優先度

1. **AskUserQuestion**（最高優先度）- カーソル付き番号選択肢
2. **Yes/No承認** - ボタン形式の確認
3. **`[y/n]`パターン** - シンプルな確認
4. **エラー検出**
5. **タイトルベース検出**（最低優先度）- スピナー/アイドル表示

## ステータス表示

AskUserQuestionが検出された場合：

```
┌─────────────────────────────────────────────────────────────┐
│ ● claude-1    [Approval: UserQuestion]    PTY              │
│   Options: 1. async/await  2. callbacks  3. promises        │
└─────────────────────────────────────────────────────────────┘
```

## Web Remote対応

AskUserQuestionはWeb Remote Controlでも動作します：

```
┌─────────────────────────────────────┐
│  どのアプローチ？                    │
│                                     │
│  [1] async/await                   │
│  [2] callbacks                     │
│  [3] promises                      │
│                                     │
└─────────────────────────────────────┘
```

ボタンをタップして選択。

## なぜ重要か

**tmaiなし：**
1. 選択肢を読む
2. 手動で回答を入力
3. フォーマットが正しいことを祈る

**tmaiあり：**
1. 番号キーを押す
2. 完了

複数エージェントを管理する場合、素早い応答がワークフローを円滑にします。

## 次のステップ

- [PTYラッピング](./pty-wrapping.md) - より正確な検出
- [Web Remote Control](./web-remote.md) - スマホから操作
