# Web Remote Control

QRコードでスマホからAIエージェントを操作。

## 概要

Web Remote Controlは、Webブラウザを持つ任意のデバイスからAIエージェントのリクエストを監視・承認できます。QRコードをスキャンして即座に接続。

## 機能

- エージェント一覧のリアルタイム更新（SSE）
- y/n承認ボタン
- AskUserQuestion選択肢の選択
- 複数選択対応
- テキスト入力
- ペインプレビュー（5秒自動更新）
- ダーク/ライトテーマ切り替え
- 状態変化時のトースト通知

## クイックスタート

### 1. tmaiを起動

```bash
tmai
```

### 2. QRコードを表示

`r`を押してQRコードを表示：

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   ███████████████████████████                               │
│   █ ▄▄▄▄▄ █▀▄▀▄▀▀▄█ ▄▄▄▄▄ █                               │
│   █ █   █ █▄▀█▀▄▀▄█ █   █ █                               │
│   █ █▄▄▄█ █ ▄▀▄█▀██ █▄▄▄█ █                               │
│   ███████████████████████████                               │
│                                                             │
│   スマホでスキャン                                          │
│   http://192.168.1.100:9876/?token=xxxx                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. スキャンして接続

スマホのカメラでQRコードをスキャンし、ブラウザで開く。

## モバイルインターフェース

### エージェント一覧

```
┌─────────────────────────────────────┐
│  tmai Remote                    ☀️  │
├─────────────────────────────────────┤
│                                     │
│  ● agent-1        [Approval]        │
│    → Approve                        │
│                                     │
│  ○ agent-2        [Processing]      │
│                                     │
│  ○ agent-3        [Idle]            │
│                                     │
└─────────────────────────────────────┘
```

### 承認ボタン

- **Approve** - `Enter`を送信して確定

> **Note**: 拒否やその他の選択は、数字キーまたはテキスト入力を使用してください。

### AskUserQuestion

選択肢がある場合：

```
┌─────────────────────────────────────┐
│  どのアプローチ？                    │
│                                     │
│  [1] async/await                   │
│  [2] callbacks                     │
│  [3] promises                      │
│                                     │
└─────────────────────────────────────┘
```

ボタンをタップして選択。

### 複数選択

複数選択の質問では、選択をトグルしてSubmitをタップ：

```
┌─────────────────────────────────────┐
│  どの機能が必要？                    │
│                                     │
│  [1] ✓ 認証                        │
│  [2]   ダークモード                 │
│  [3] ✓ API連携                     │
│                                     │
│  [Submit]                           │
└─────────────────────────────────────┘
```

### テキスト入力

自由入力が必要な場合：

```
┌─────────────────────────────────────┐
│  APIエンドポイントを入力:            │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ https://api.example.com     │   │
│  └─────────────────────────────┘   │
│  [Send]                             │
└─────────────────────────────────────┘
```

### ペインプレビュー

エージェントをタップしてペイン内容を表示。5秒ごとに自動更新。

## 設定

`~/.config/tmai/config.toml`:

```toml
[web]
enabled = true  # Webサーバーを有効化（デフォルト: true）
port = 9876     # ポート番号（デフォルト: 9876）
```

## セキュリティ

- **トークン認証**: URLにランダムトークンを含む
- **LAN限定アクセス**: 同一ネットワークからのみアクセス可能
- **外部公開なし**: デフォルトで外部インターフェースにバインドしない

## ネットワーク設定

### 同一LAN

スマホとPCが同じWi-Fiネットワーク上にあれば直接動作。

### WSL環境

#### Mirroredモード（推奨）

`.wslconfig`に`networkingMode=mirrored`がある場合：

```powershell
# Windowsファイアウォールでポートを許可（管理者権限で実行）
New-NetFirewallRule -DisplayName "tmai Web Remote" -Direction Inbound -Protocol TCP -LocalPort 9876 -Action Allow
```

#### NATモード

mirroredモードを使用していない場合：

```powershell
# ポートフォワーディングを設定（管理者権限で実行）
.\scripts\setup-wsl-portforward.ps1

# 削除する場合
.\scripts\setup-wsl-portforward.ps1 -Remove
```

**注意**: NATモードではWSLのIPがリブートで変わります。接続できなくなったらスクリプトを再実行してください。

## REST API

プログラムからのアクセス用：

| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/agents` | エージェント一覧 |
| POST | `/api/agents/:id/approve` | 承認（y送信） |
| POST | `/api/agents/:id/reject` | 拒否（n送信） |
| POST | `/api/agents/:id/select` | 選択肢選択 |
| POST | `/api/agents/:id/submit` | 複数選択確定 |
| POST | `/api/agents/:id/input` | テキスト送信 |
| GET | `/api/agents/:id/preview` | ペイン内容取得 |
| GET | `/api/events` | SSEストリーム |

詳細は[Web APIリファレンス](../reference/web-api.md)を参照。

## 次のステップ

- [Web APIリファレンス](../reference/web-api.md) - 完全なAPIドキュメント
- [スマホから承認ワークフロー](../workflows/remote-approval.md) - 使用シナリオ
