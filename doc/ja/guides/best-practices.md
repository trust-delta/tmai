# ベストプラクティス

tmaiを効果的に使うためのおすすめの方法。

## ワークフローのコツ

### 新規セッションにはPTYラッピングを使用

可能な限り、新しいAIエージェントはPTYラッピングで起動：

```bash
# 推奨
tmai wrap claude

# 代わりに
claude  # その後capture-paneで監視
```

メリット：
- より正確な状態検出
- 外部送信検知が有効
- 状態変化への高速な応答

### tmaiは専用ペインで実行

一貫したレイアウトを作成：

```
┌───────────────────────┬───────────────────────┐
│                       │                       │
│    エージェントペイン  │      tmaiペイン       │
│                       │                       │
│                       │                       │
└───────────────────────┴───────────────────────┘
```

または小さめのtmaiペイン：

```
┌───────────────────────────────────────────────┐
│                                               │
│             エージェントペイン                 │
│                                               │
├───────────────────────────────────────────────┤
│  tmai (Listビュー)                            │
└───────────────────────────────────────────────┘
```

### ビューモードを適切に使用

| モード | 最適な用途 |
|--------|----------|
| Split | 1-3エージェントをプレビュー付きで監視 |
| List | 多数のエージェントを一度に監視 |
| Preview | 単一エージェントの出力に集中 |

`Tab`で切り替え。

### Session/Window/Allの使い分け

> **Note**: モニタースコープ(`m`)はAgent Teams統合が有効な間、一時的に無効化されています。スコープはAllSessionsに固定されています。

| スコープ | ユースケース |
|---------|-------------|
| All | 全エージェントの概要 |
| Session | 現在のプロジェクトに集中 |
| Window | 特定のタスクに集中 |

## マルチエージェントのコツ

### 命名規則

わかりやすいセッション/ウィンドウ名を使用：

```bash
# わかりやすい命名
tmux new-session -s project-a
tmux new-window -n feature-auth

# エージェントは次のように表示: project-a:feature-auth
```

### ワークツリーワークフロー

Gitワークツリーを使用する場合：

```bash
# ワークツリーを作成
git worktree add ../project-feature-a feature/a

# ワークツリーでエージェントを起動
cd ../project-feature-a
tmux new-session -s feature-a
tmai wrap claude
```

tmaiは既存のセッションを監視します—特別なコマンドは不要。

## Agent Teamsのコツ

### チーム進捗を監視

Claude Code Agent Teamsを使用する場合、チーム一覧画面（`T`）で全チームとタスク進捗を一目で確認できます。

### タスクオーバーレイで詳細確認

エージェント一覧でチームメンバーを選択し、`t`を押すとチームのタスク一覧とステータスが表示されます。

### スキャン間隔の調整

チームデータの更新頻度が高すぎる/低すぎる場合：

```toml
[teams]
scan_interval = 2  # より高頻度な更新（デフォルト: 5）
```

## セキュリティのコツ

### 監査用にデバッグログを有効化

機密性の高いタスクを実行する場合：

```bash
tmai --debug 2>&1 | tee ~/tmai-audit.log
```

これで外部送信検知ログをキャプチャ。

### 外部送信ログを定期的に確認

予期しない外部送信をチェック：

```bash
grep "External transmission" ~/tmai-audit.log
grep "Sensitive data" ~/tmai-audit.log
```

### Web Remoteの公開を制限

- 必要な時だけ有効化
- 信頼できるネットワークで使用
- QRコード/URLを公に共有しない

## パフォーマンスのコツ

### 多数のエージェントでポーリング頻度を下げる

多数のエージェント監視でラグが発生する場合：

1. Session/Windowスコープで監視ペインを制限
2. エージェントをバッチで実行

### 概要にはListビューを使用

プレビュー付きSplitビューはより多くのリソースを使用。ステータス確認だけならListビューに切り替え。

## トラブルシューティング

### エージェントが検出されない

1. エージェントがtmuxペインにあるか確認
2. プロセス名が対応エージェントと一致するか確認
3. tmaiを再起動してみる

### 状態が誤検出される

1. より正確な検出のためPTYラッピングを使用
2. 検出ソース（ステータスバーのPTY vs CAP）を確認
3. 再現手順とともに問題を報告

### Web Remoteに接続できない

1. 設定で`[web] enabled = true`を確認
2. ファイアウォールがポートを許可しているか確認
3. WSLの場合、ネットワーキングモードとポートフォワーディングを確認

### CPU使用率が高い

1. 監視ペイン数を減らす
2. Session/Windowスコープを使用
3. Listビューに切り替え

## アンチパターン

### やらない方がいいこと

- tmaiをエージェントと同じペインで実行
- 公共ネットワークでWeb Remote URLを共有
- 外部送信検知の警告を無視
- パススルーモードを長時間使用

### やるべきこと

- tmaiは専用の監視ペインで維持
- エージェントの活動を定期的に確認
- 適切なビューモードを使用
- おかしいと思ったらログを確認

## 次のステップ

- [tmaiの強み](./strengths.md) - tmaiのユニークな点
- [マルチエージェント監視](../workflows/multi-agent.md) - 複数エージェントの管理
